#!/bin/bash

if test "$1" = "--help" ; then
    echo \
"Usage: $(echo $0 | sed 's#.*/##g')

Generates a HTML page that contains information on import-statements of
all Java source files of the project. The main intention of the
information is to help to understand what external dependencies a project
has.

Requires project-info."
    exit
fi

source javautils-project-info

allImportedClasses="$(grep -h '^ *import \+' $(find "$srcRoot" -name '*.java' -a -not -name '.*') | sed -e 's#^ *import *##g' -e 's# \+##g' -e 's#;.*$##g' | sort | uniq)"
allImportedPackages="$(echo "$allImportedClasses" | sed 's#\.[^.]*$##g' | sort | uniq)"

function format-ul {
    echo \
"<ul>
$(echo "$1" | sed -e 's#^#<li><tt>#g' -e 's#$#</tt></li>#g')
</ul>"
}

echo \
"<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\">
<html>
<head><title>$capitalizedPrjName: Unique imports</title></head>
<body>

<h1>$capitalizedPrjName: Unique imports</h1>

<p>Knowing everything that a project imports should help to understand the
external dependencies of a project.</p>

<h2>Imported external packages</h2>
$(format-ul "$(echo "$allImportedPackages" | grep -v "^$prjBasePackage")")

<h2>Imported external classes</h2>
$(format-ul "$(echo "$allImportedClasses" | grep -v "^$prjBasePackage")")

<h2>Imported internal packages</h2>
$(format-ul "$(echo "$allImportedPackages" | grep "^$prjBasePackage")")

<h2>Imported internal classes</h2>
$(format-ul "$(echo "$allImportedClasses" | grep "^$prjBasePackage")")

<hr>
This page was generated by the script <tt>$(sed-from "$0" -e 's#.*/##g')</tt> on $(date).
</body>
</html>"
