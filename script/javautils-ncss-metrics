#!/bin/bash

if test "$1" = "--help" ; then
    echo \
"Usage: $(echo $0 | sed 's#.*/##g')

Generates a HTML page that contains information on a number of complexity
metrics, namely CCN/McCabe and NCSS, relevant at the level of individual
methods. The main intention of the information is to help identify
possible problem spots.

Requires project-info."
    exit
fi

source javautils-project-info

srcFiles="$(find $srcRoot -path '*.java' -a -not -path '*/detail/*')"

echo \
"<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\">
<html>
<head><title>$capitalizedPrjName: Method level metrics</title></head>
<body>
<h1>$capitalizedPrjName: Method level metrics</h1>

<p>CCN is the Cyclomatic Complexity Number and is a good indicator of complex methods.</p>
<p>NCSS measures Non-Commented Source Statements.</p>

<table summary=\"Method level metrics in descending order of CCN\">
<tr>  <th>CCN</th> <th>NCSS</th> <th>Method</th></tr>
$(export CLASSPATH="$(javautils-read-classpath javancss javancssClasspath):$CLASSPATH" && \
  java javancss.Main -function $srcFiles | \
  sed -e 's#^ *[A-Z].*$##g' \
      -e 's#^\( *[0-9]\+\)\( \+[0-9]\+\)\( \+[0-9]\+\)\( \+[0-9]\+\)\(.*\)$#<tr><td>\3</td><td>\2</td><td><tt>\5</tt></td></tr>#g' | \
  sort --reverse)
</table>
<hr>
This page was generated by the script <tt>$(sed-from "$0" -e 's#.*/##g')</tt> using <a target=\"_top\" href=\"http://www.kclee.com/clemens/java/javancss/\">JavaNCSS</a> on $(date).
</body>
</html>"
