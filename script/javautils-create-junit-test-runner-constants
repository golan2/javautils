#!/bin/bash

if test "$#" -lt 3 -o "$1" == --help ; then
    echo "Usage: $(echo $0 | sed 's#.*/##g') <runner-constants-interface> <source-root-dir> <test-path-pattern>

Creates a simple constants interface that contains an array of every JUnit
test class found under the source root directory with the test path
pattern."
    exit
fi

source javautils-functions

runnerPackage=$(pkg-of-qcl "$1")
runnerClass=$(ucl-of-qcl "$1")
srcRoot="$2"
testPattern="$3"

testCases="$(sed-from "$(find "$srcRoot" -path "$testPattern" -a -not -name '.*' | sort --ignore-case)" -e "s#$srcRoot/##g" -e 's#\.java##g' -e 's#/#.#g')"

echo \
"package $runnerPackage;

/**
 * <p>Contains an array of test classes (matching the pattern '$testPattern').</p>
 */
public interface $runnerClass {

  // WARNING: This class is automatically generated by the script:
  //
  //   $(sed-from "$0" -e 's#.*/##g')
  //
  // You should probably edit the script rather than this class.

  /**
   * <p>An array of the following classes:</p>
   * <ul>
$(sed-from "$testCases" -e 's#\(..*\)#   * <li>{@link \1}</li>#g')
   * </ul>
   */
  static final Class[] TESTS = {
$(sed-from "$testCases" -e 's#\(..*\)#    \1.class,#g')
  };
}"
